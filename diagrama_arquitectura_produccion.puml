@startuml DiagramaArquitecturaProduccionRehaVR
!theme plain
skinparam componentStyle rectangle
skinparam linetype ortho

title Diagrama de Arquitectura: Optimizaci√≥n y Preparaci√≥n para Producci√≥n\nSistema RehaVR - Rehabilitaci√≥n Motora

' ============================================
' CAPA DE PRESENTACI√ìN (Frontend)
' ============================================
package "üåê Capa de Presentaci√≥n - Frontend Optimizado" #E3F2FD {
    component [CDN] as cdn #BBDEFB {
        [Assets Est√°ticos]
        [Im√°genes]
        [CSS/JS Minificados]
    }
    
    component [Load Balancer] as lb_frontend #90CAF9 {
        [Nginx Reverse Proxy]
        [SSL/TLS Termination]
        [Rate Limiting]
    }
    
    component [Frontend React] as frontend #64B5F6 {
        [Vite Build Production]
        [Code Splitting]
        [Lazy Loading]
        [Service Worker PWA]
    }
}

' ============================================
' CAPA DE APLICACI√ìN (Backend)
' ============================================
package "‚öôÔ∏è Capa de Aplicaci√≥n - Backend Escalable" #E8F5E9 {
    component [API Gateway] as api_gateway #A5D6A7 {
        [Kong / AWS API Gateway]
        [Autenticaci√≥n JWT]
        [Rate Limiting]
        [Request Routing]
    }
    
    component [Load Balancer Backend] as lb_backend #81C784 {
        [Nginx / HAProxy]
        [Health Checks]
        [Session Affinity]
    }
    
    component [Flask Application] as flask_app #66BB6A {
        [Gunicorn Workers]
        [Uvicorn ASGI]
        [Blueprints]
        [Controllers]
    }
    
    component [Cach√© Layer] as cache #C8E6C9 {
        [Redis Cluster]
        [Session Store]
        [Query Cache]
        [Rate Limit Store]
    }
    
    component [Message Queue] as mq #A5D6A7 {
        [RabbitMQ / Celery]
        [Task Queue]
        [Background Jobs]
    }
}

' ============================================
' CAPA DE SERVICIOS
' ============================================
package "üß© Capa de Servicios - Business Logic" #FFF3E0 {
    component [Service Layer] as services #FFCC80 {
        [PacienteService]
        [EjercicioService]
        [AnalyticsService]
        [NotificationService]
    }
    
    component [Repository Layer] as repositories #FFB74D {
        [PacienteRepository]
        [EjercicioRepository]
        [HistorialRepository]
    }
}

' ============================================
' CAPA DE DATOS
' ============================================
package "üóÑÔ∏è Capa de Datos - Persistencia Optimizada" #FCE4EC {
    component [Database Primary] as db_primary #F48FB1 {
        [MySQL Master]
        [Write Operations]
        [ACID Transactions]
    }
    
    component [Database Replicas] as db_replicas #F06292 {
        [MySQL Read Replicas]
        [Read Operations]
        [Load Distribution]
    }
    
    component [Database Pool] as db_pool #EC407A {
        [Connection Pooling]
        [Query Optimization]
        [Indexes]
    }
    
    component [Backup System] as backup #E91E63 {
        [Automated Backups]
        [Point-in-Time Recovery]
        [Offsite Storage]
    }
}

' ============================================
' CAPA DE MONITOREO Y LOGGING
' ============================================
package "üìä Capa de Monitoreo y Observabilidad" #E1BEE7 {
    component [Logging] as logging #CE93D8 {
        [ELK Stack]
        [Centralized Logs]
        [Log Aggregation]
    }
    
    component [Metrics] as metrics #BA68C8 {
        [Prometheus]
        [Grafana Dashboards]
        [Custom Metrics]
    }
    
    component [APM] as apm #AB47BC {
        [Application Performance]
        [Error Tracking]
        [Performance Monitoring]
    }
    
    component [Alerting] as alerting #9C27B0 {
        [AlertManager]
        [PagerDuty Integration]
        [Email/SMS Alerts]
    }
}

' ============================================
' CAPA DE SEGURIDAD
' ============================================
package "üîí Capa de Seguridad" #FFEBEE {
    component [WAF] as waf #EF9A9A {
        [Web Application Firewall]
        [DDoS Protection]
        [SQL Injection Prevention]
    }
    
    component [Auth Service] as auth #E57373 {
        [JWT Tokens]
        [OAuth 2.0]
        [Session Management]
    }
    
    component [Secrets Manager] as secrets #EF5350 {
        [Vault / AWS Secrets]
        [Encrypted Credentials]
        [Key Rotation]
    }
}

' ============================================
' CAPA DE CI/CD
' ============================================
package "üöÄ Capa de CI/CD - DevOps" #E0F2F1 {
    component [CI Pipeline] as ci #80CBC4 {
        [GitHub Actions / GitLab CI]
        [Automated Tests]
        [Code Quality Checks]
        [Security Scanning]
    }
    
    component [CD Pipeline] as cd #4DB6AC {
        [Automated Deployment]
        [Blue-Green Deployment]
        [Rollback Capability]
    }
    
    component [Container Registry] as registry #26A69A {
        [Docker Hub / ECR]
        [Image Versioning]
        [Security Scanning]
    }
}

' ============================================
' INFRAESTRUCTURA
' ============================================
package "‚òÅÔ∏è Infraestructura - Cloud/On-Premise" #F3E5F5 {
    component [Container Orchestration] as k8s #BA68C8 {
        [Kubernetes Cluster]
        [Auto-scaling]
        [Service Mesh]
        [Health Checks]
    }
    
    component [Storage] as storage #AB47BC {
        [Object Storage S3]
        [Block Storage]
        [File System]
    }
    
    component [Networking] as network #9C27B0 {
        [VPC / Private Network]
        [Load Balancers]
        [DNS Management]
    }
}

' ============================================
' CONEXIONES Y FLUJOS
' ============================================
cdn --> lb_frontend : HTTPS
lb_frontend --> frontend : HTTP/2
frontend --> api_gateway : API Calls

api_gateway --> lb_backend : Route
lb_backend --> flask_app : Load Balance
flask_app --> cache : Cache Lookup
flask_app --> services : Business Logic
services --> repositories : Data Access
repositories --> db_pool : Queries
db_pool --> db_primary : Writes
db_pool --> db_replicas : Reads
db_primary --> db_replicas : Replication
db_primary --> backup : Backup

flask_app --> mq : Async Tasks
mq --> services : Background Processing

flask_app --> logging : Logs
flask_app --> metrics : Metrics
logging --> alerting : Alerts
metrics --> alerting : Alerts
metrics --> apm : Performance Data

waf --> api_gateway : Filtered Requests
auth --> api_gateway : Token Validation
secrets --> flask_app : Credentials

ci --> registry : Build Images
cd --> k8s : Deploy
registry --> k8s : Pull Images
k8s --> flask_app : Run Containers
k8s --> frontend : Run Containers
k8s --> db_primary : Database Pods
k8s --> cache : Redis Pods

storage --> flask_app : File Storage
network --> k8s : Network Layer

' ============================================
' NOTAS Y OPTIMIZACIONES
' ============================================
note right of frontend
  **Optimizaciones Frontend:**
  - Code splitting por rutas
  - Lazy loading de componentes
  - Tree shaking
  - Minificaci√≥n y compresi√≥n
  - Service Worker para PWA
  - CDN para assets est√°ticos
end note

note right of flask_app
  **Optimizaciones Backend:**
  - Gunicorn con m√∫ltiples workers
  - Async/await para I/O
  - Connection pooling
  - Query optimization
  - Response caching
  - Compression middleware
end note

note right of db_primary
  **Optimizaciones Base de Datos:**
  - √çndices en columnas frecuentes
  - Particionamiento de tablas
  - Read replicas para queries
  - Connection pooling
  - Query result caching
  - Automated backups
end note

note right of cache
  **Estrategia de Cach√©:**
  - Cache de sesiones
  - Cache de queries frecuentes
  - Cache de resultados de API
  - TTL configurable
  - Invalidation strategy
end note

note right of k8s
  **Escalabilidad:**
  - Auto-scaling horizontal
  - Resource limits y requests
  - Health checks autom√°ticos
  - Rolling updates
  - Zero-downtime deployments
end note

note right of ci
  **CI/CD Pipeline:**
  1. Code commit
  2. Run tests
  3. Build Docker images
  4. Security scan
  5. Push to registry
  6. Deploy to staging
  7. Integration tests
  8. Deploy to production
end note

@enduml

